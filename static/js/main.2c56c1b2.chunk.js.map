{"version":3,"sources":["ENSReverse.tsx","App.tsx","index.tsx"],"names":["ethereum","window","web3","Web3","logger","css","args","splice","console","log","apply","onboarding","MetamaskOnboarding","useState","name","setName","self","net","revRegistrar","rev","owner","address","revOwner","resolver","revName","titles","setTitles","addrs","setAddrs","tracts","setTracts","updateAddr","obj","as","updateTract","ts","reset","on","accts","useEffect","undefined","handlers","func","startOnboarding","if","isMetaMaskInstalled","stopOnboarding","err","warn","a","request","method","addresses","addr","parseInt","networkVersion","Error","revAddr","substr","eth","ens","getOwner","getResolver","test","options","unset","getAddress","Contract","revRegistrarABI","methods","defaultResolver","call","revResolver","node","claim","send","from","alert","confirm","justify","textAlign","value","onChange","evt","target","templateColumns","alignItems","Object","entries","map","i","key","title","display","sx","bg","m","pr","minW","textOverflow","h","onClick","disabled","py","mt","className","ENSReverse","ReactDOM","render","StrictMode","App","document","getElementById"],"mappings":"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","file":"static/js/main.2c56c1b2.chunk.js","sourcesContent":["import { useState } from 'react'\nimport Web3 from 'web3'\nimport MetamaskOnboarding from '@metamask/onboarding'\nimport {\n  Stack, Input, Container, Flex, Button, Text, Box, Grid,\n} from '@chakra-ui/react'\nimport { AbiItem } from 'web3-utils'\nimport { Contract } from 'web3-eth-contract'\nimport { abi as revRegistrarABI } from '@ensdomains/ens-contracts/artifacts/contracts/registry/ReverseRegistrar.sol/ReverseRegistrar.json'\nimport { useEffect } from 'react'\n\ndeclare global {\n  interface Window {\n    ethereum: any\n  }\n}\nconst { ethereum } = window\nconst web3 = new Web3(ethereum)\n\nconst logger = (css: string) => (\n  (...args: unknown[]) => {\n    args[0] = `%c ${args[0]} `\n    args.splice(1, 0, css)\n    console.log.apply(this, args)\n  }\n)\n\ninterface Addresses extends Partial<Record<string, string>> {\n  self?: string\n  address?: string\n  owner?: string\n  rev?: string\n  net?: string\n  resolver?: string\n  revRegistrar?: string\n  ens?: string\n  defaultResolver?: string\n  revOwner?: string\n  revName?: string\n}\n\ninterface Contracts {\n  revResolver?: Contract\n  revRegistrar?: Contract\n}\n\n// eslint-disable-next-line import/no-anonymous-default-export\nexport default () => {\n  const onboarding = new MetamaskOnboarding()\n  const [name, setName] = useState('subdomain.ensname.eth')\n  const [titles, setTitles] = useState({\n    self: 'Your Address',\n    net: 'Current Network',\n    revRegistrar: 'Reverse Registrar Address',\n    rev: 'Reverse Address',\n    owner: null as string | null,\n    address: null as string | null,\n    revOwner: `Reverse Lookup Owner`,\n    resolver: 'Resolver Address',\n    revName: 'Reverse Lookup',\n  })\n  const [addrs, setAddrs] = useState<Addresses>({})\n  const [tracts, setTracts] = useState<Contracts>({})\n\n  const updateAddr = (obj: object) => {\n    setAddrs(as => ({ ...as, ...obj }))\n  }\n  const updateTract = (obj: object) => {\n    setTracts(ts => ({ ...ts, ...obj }))\n  }\n\n  const reset = () => {\n    setAddrs({})\n    setTracts({})\n  }\n  ethereum?.on('chainChanged', reset)\n  ethereum?.on('accountsChanged',\n    (accts: string[]) => {\n      reset()\n      updateAddr({ self: accts[0] })\n    }\n  )\n\n  useEffect(() => {\n    setTitles((ts) => (\n      {\n        ...ts,\n        owner: `${name} Owner`,\n        address: `${name} Address`,\n      }\n    ))\n    setAddrs((as) => (\n      { ...as, owner: undefined, address: undefined }\n    ))\n  }, [name])\n\n  const handlers = [\n    {\n      name: 'Install MetaMask',\n      func: () => onboarding.startOnboarding(),\n      if: () => !MetamaskOnboarding.isMetaMaskInstalled(),\n    },\n    {\n      name: 'Stop Onboarding',\n      func: () => { try {\n        onboarding.stopOnboarding()\n      } catch(err) {\n        console.warn(err)\n      } },\n      if: () => !MetamaskOnboarding.isMetaMaskInstalled(),\n    },\n    {\n      name: 'Enable Ethereum on this Site',\n      func: async () => {\n        const log = logger('color: purple')\n        log('Enabling Inpage Provider')\n        const addresses = await (\n          ethereum?.request({ method: 'eth_requestAccounts' })\n        )\n        const addr = addresses?.[0]\n        log('Wallet Address', addr)\n        updateAddr({ self: addr })\n      },\n      if: () => (!!ethereum && !addrs.self),\n    },\n    {\n      name: 'Load Addresses',\n      func: async () => {\n        const log = logger('color: orange; background-color: purple')\n\n        const net = (() => {\n          switch(parseInt(ethereum?.networkVersion)) {\n            case 1: return 'mainnet'\n            case 2: return 'Morden'\n            case 3: return 'Ropsten'\n            case 4: return 'Rinkeby'\n            case 42: return 'Kovan'\n            case 100: return 'xDAI'\n            default: return `unknown (id:${ethereum?.networkVersion})`\n          }\n        })()\n        log('Setting addrs.net', net)\n        updateAddr({ net })\n\n        if(!addrs.self) throw new Error('Wallet Address Not Set')\n        const revAddr = (\n          `${addrs.self.substr(2)}.addr.reverse`\n        )\n        log('Adding Reverse Address', revAddr)\n        updateAddr({ rev: revAddr })\n\n        const revRegistrar = (\n          await web3.eth.ens.getOwner('addr.reverse')\n        )\n        log('revReg', revRegistrar)\n        updateAddr({ revRegistrar })\n\n        const revOwner = await web3.eth.ens.getOwner(revAddr)\n        updateAddr({ revOwner })\n\n        const resolver = await web3.eth.ens.getResolver(name)\n        if(/^0x0+$/.test(resolver.options.address)) {\n          const unset = <em>Unset</em>\n          updateAddr({ address: unset })\n          updateAddr({ owner: unset })\n        } else {\n          const address = await web3.eth.ens.getAddress(name)\n          updateAddr({ address })\n          updateAddr({\n            owner: await web3.eth.ens.getOwner(address)\n          })\n        }\n      },\n      if: () => (!!addrs.self && (\n        !addrs.net || !addrs.address || !addrs.owner\n      )),\n    },\n    {\n      name: 'Load Contracts',\n      func: async () => {\n        const log = logger('color: lightgray; background-color: black')\n\n        if(!addrs.revRegistrar) {\n          throw new Error('Reverse Registrar Address Not Set')\n        }\n        const revRegistrar = new web3.eth.Contract(\n          revRegistrarABI as AbiItem[], addrs.revRegistrar\n        )\n        log('Reverse Registrar', revRegistrar.options.address)\n        updateTract({ revRegistrar })\n\n        const defaultResolver = await (\n          revRegistrar.methods.defaultResolver().call()\n        )\n        updateAddr({ defaultResolver })\n\n        if(!addrs.rev) {\n          throw new Error('Reverse Address Is Not Set')\n        }\n        const revResolver = await (\n          web3.eth.ens.getResolver(addrs.rev)\n        )\n        updateTract({ revResolver })\n        const resolver = revResolver.options.address\n        updateAddr({ resolver })\n\n        if(/^0x0+$/.test(resolver)) {\n          updateAddr({ revName: undefined })\n        } else {\n          const node = await (\n            revRegistrar.methods.node(addrs.self).call()\n          )\n          const revName = (\n            await revResolver.methods.name(node).call()\n          )\n          updateAddr({ revName })\n        }\n      },\n      if: () => (!!addrs.revRegistrar && !tracts.revRegistrar),\n    },\n    {\n      name: 'Claim the Reverse Address',\n      func: async () => {\n        if(addrs.revOwner !== addrs.self) {\n          await (\n            tracts.revRegistrar\n            ?.methods.claim(addrs.self)\n            .send({ from: addrs.self })\n          )\n          if(!addrs.rev) throw new Error('Missing Reverse Address')\n          const revOwner = await web3.eth.ens.getOwner(addrs.rev)\n          updateAddr({ revOwner })\n        }\n      },\n      if: () => (\n        /^0x0+$/.test(addrs.revOwner ?? '') && !!tracts.revRegistrar\n      )\n    },\n    {\n      name: 'Link Reverse Name',\n      func: async () => {\n        if(addrs.revName === name) {\n          return alert(`Reverse Already Set To: ${name}`)\n        }\n        if(\n          !addrs.revName\n          || window.confirm(`Overwrite ${addrs.revName}?`)\n        ) {\n          if(!tracts.revRegistrar) {\n            throw new Error('Reverse Registrar Not Set')\n          }\n          await (\n            tracts.revRegistrar.methods\n            .setName(name)\n            .send({ from: addrs.self })\n          )\n\n          if(!tracts.revResolver) {\n            throw new Error('Reverse Resolver Not Set')\n          }\n          const node = await (\n            tracts.revRegistrar.methods\n            .node(addrs.self)\n            .call()\n          )\n          const revName = await (\n            tracts.revResolver.methods.name(node).call()\n          )\n          updateAddr({ revName })\n        }\n      },\n      if: () => (\n        !/^0x0+$/.test(addrs.revOwner ?? '')\n        && !!tracts.revResolver\n        && !!tracts.revRegistrar\n      )\n    }\n  ]\n\n  return (\n    <Container>\n      <Stack>\n        <Flex justify=\"center\">\n          <Input\n            textAlign=\"right\"\n            value={name}\n            onChange={evt => setName(evt.target.value)}\n          />\n        </Flex>\n        <Grid templateColumns=\"auto 1fr\" alignItems=\"center\">\n          {Object.entries(titles).map(([key, title], i) => (\n            <Box key={i} display=\"contents\" sx={{ '&:hover > *': { bg: 'yellow' } }}>\n              <Text m={0} textAlign=\"right\" pr={5} minW=\"12em\">{title}:</Text>\n              <Text m={0} textOverflow=\"clip\" title={addrs[key]}><code>{addrs[key]}</code></Text>\n            </Box>\n          ))}\n        </Grid>\n      </Stack>\n      <Stack>\n        {handlers.map((h, i) => (\n          <Button\n            key={i} onClick={h.func}\n            disabled={h.if ? !h.if() : false}\n            m={0} py={10} mt=\"0 ! important\"\n          >\n            {h.name}\n          </Button>\n        ))}\n      </Stack>\n    </Container>\n  )\n}","import React from 'react'\nimport { Container } from '@chakra-ui/react'\nimport ENSReverse from './ENSReverse'\n\n// eslint-disable-next-line import/no-anonymous-default-export\nexport default () => (\n  <Container className=\"App\">\n    <ENSReverse/>\n  </Container>\n)","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport App from './App'\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root'),\n)"],"sourceRoot":""}